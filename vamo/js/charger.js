import*as THREE from"../three/three.module.js";import{OBJLoader}from"../three/loaders/OBJLoader.js";import{MTLLoader}from"../three/loaders/MTLLoader.js";import{GLTFLoader}from"../three/loaders/GLTFLoader.js";import{FBXLoader}from"../three/loaders/FBXLoader.js";import{PDBLoader}from"../three/loaders/PDBLoader.js";let animMixer=void 0,groupeFichierModele=new THREE.Group,afficher;function chargerNormaliser(e){var r=new THREE.Box3,o=(r.setFromObject(e),new THREE.Sphere);r.getBoundingSphere(o),e.position.addScaledVector(o.center.negate(),1/o.radius),e.scale.multiplyScalar(1/o.radius)}function chargerModele(r,o,n,a,t){if(afficher=a,groupeFichierModele.name="groupeFichierModele",null!=o&&""!=o){var i=new THREE.LoadingManager;i.onStart=function(e,r,o){t.innerHTML=r+" de "+o+" fichiers : "+e},i.onProgress=function(e,r,o){t.innerHTML=r+" de "+o+" fichiers : "+e},i.onLoad=function(){t.innerHTML=""};let e=!(i.onError=function(e){t.innerHTML="Erreur de chargement de "+e});a=o;switch(a.substr(a.lastIndexOf(".")+1)){case"obj":(e=null!=n&&""!=n)?chargerModeleOBJMTL(r+o,r+n,i):chargerModeleOBJ(r+o,i);break;case"gltf":e=!0,chargerModeleGLTF(r+o,i);break;case"fbx":e=!0,chargerModeleFBX(r+o,i);break;case"pdb":case"mol":e=!1,chargerModelePDB(r+o,i)}}}function chargerModeleOBJinterieur(e){chargerNormaliser(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.side=THREE.DoubleSide)}),groupeFichierModele.add(e),afficher()}function chargerModeleOBJMTL(r,e,o){new MTLLoader(o).load(e,function(e){e.preload(),new OBJLoader(o).setMaterials(e).load(r,function(e){chargerModeleOBJinterieur(e)},void 0,function(e){console.error(e)})})}function chargerModeleOBJ(e,r){new THREE.MeshPhongMaterial({color:16776960});new OBJLoader(r).load(e,function(e){chargerModeleOBJinterieur(e)},void 0,function(e){console.error(e)})}function chargerModeleGLTF(e,r){new GLTFLoader(r).load(e,function(e){var r;chargerNormaliser(e.scene),0<e.animations.length?(animMixer=new THREE.AnimationMixer(e.scene),r=e.animations,(r=animMixer.clipAction(r[0])).reset(),r.fadeIn(1),r.play()):animMixer=void 0,groupeFichierModele.add(e.scene),afficher()},void 0,function(e){console.error(e)})}function chargerModeleFBX(e,r){new FBXLoader(r).load(e,function(e){groupeFichierModele.add(e),afficher()},void 0,function(e){console.error(e)})}function chargerModelePDB(e,r){new PDBLoader(r).load(e,function(e){var r=new THREE.Group,o=new THREE.Group,n=new THREE.Group,a=(n.add(r),n.add(o),e.geometryAtoms),t=e.geometryBonds,i=e.json,c=new THREE.BoxGeometry(1,1,1),d=new THREE.IcosahedronGeometry(1,3),e=(a.computeBoundingBox(),new THREE.Vector3);a.boundingBox.getCenter(e).negate(),a.translate(e.x,e.y,e.z),t.translate(e.x,e.y,e.z);let l=a.getAttribute("position");var s=a.getAttribute("color"),g=new THREE.Vector3,u=new THREE.Color;for(let e=0;e<l.count;e++){g.x=l.getX(e),g.y=l.getY(e),g.z=l.getZ(e),u.r=s.getX(e),u.g=s.getY(e),u.b=s.getZ(e);var h=new THREE.MeshPhongMaterial({color:u}),h=new THREE.Mesh(d,h),h=(h.position.copy(g),h.position.multiplyScalar(75),h.scale.multiplyScalar(25),r.add(h),i.atoms[e]),f=document.createElement("div");f.className="label",f.style.color="rgb("+h[3][0]+","+h[3][1]+","+h[3][2]+")",f.textContent=h[4]}l=t.getAttribute("position");var E=new THREE.Vector3,M=new THREE.Vector3;for(let e=0;e<l.count;e+=2){E.x=l.getX(e),E.y=l.getY(e),E.z=l.getZ(e),M.x=l.getX(e+1),M.y=l.getY(e+1),M.z=l.getZ(e+1),E.multiplyScalar(75),M.multiplyScalar(75);var m=new THREE.Mesh(c,new THREE.MeshPhongMaterial(16777215));m.position.copy(E),m.position.lerp(M,.5),m.scale.set(5,5,E.distanceTo(M)),m.lookAt(M),o.add(m)}chargerNormaliser(n),groupeFichierModele.add(n),afficher()},void 0,function(e){console.error(e)})}export{groupeFichierModele,chargerModele,animMixer};